<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <!-- 模板 -->
  <div id="root">
    <div>
      <div>
        <p>{{name}}--{{age}}</p>
      </div>
    </div>
    <div>{{name}}</div>
    <div>{{age}}</div>
  </div>

  <script>

    /**
     * 步骤拆解
     *    1.拿到模板
     *    2.拿到数据
     *    3.将数据与模板结合，得到的是 HTML 元素，DOM元素
     *    4.放到页面中
     */
    let regkuohao = /\{\{(.+?)\}\}/g;

    // let text = '{{123}}_{{456}}';
    // text.replace(regkuohao, function(_, g1) {
    //   console.log(_, g1);
    //   return "-";
    // })
    // console.log(text);

    let tmpNode = document.querySelector('#root');
    let data = {
      name: 'mao',
      age: 18
    };

    //  将数据放到模板中
    //  当前 template 是DOM元素
    //  真正的 Vue 源码中是 DOM -> 字符串模板 -> VNode -> 真正DOM
    function compiler(template, data) { 
      let childNodes = template.childNodes;//   取出子元素
      for(let i = 0; i < childNodes.length; i ++) {
        let type = childNodes[i].nodeType;  //  1 元素，3 文本节点
        if (type === 3) {
          //  文本节点，可以判断里面是否有 {{}} 差值
          let txt = childNodes[i].nodeValue; //   该属性只有文本节点才有意义
          txt = txt.replace(regkuohao, function(_, g) {
            //  repalce使用正则匹配一次 函数就会被调用一次 
            //  函数的第 0 个参数 表示匹配到的内容
            //  函数的第 n 个参数 表示正则中的第 n 组

            //  去除字符串两边的空白
            let key = g.trim();
            let value = data[key];
            return value;
          })
          //  注意：txt 现在和DOM没有关系
          childNodes[i].nodeValue = txt;
        } else if (type === 1) {
          //  元素，通过递归判断是否有子元素 是否将其子元素 判断是有 {{}} 值
          compiler(childNodes[i], data);
        }
      }
    }
    console.log(tmpNode);
    let generteNode = tmpNode.cloneNode(true);
    compiler(generteNode, data);
    console.log(generteNode);
    root.parentNode.replaceChild(generteNode, root);

    /**
     *  上面思路的问题
     *  1.Vue 使用的虚拟 Dom
     *  2.只考虑单属性 {{name}}  
     *  3.代码没整合 
     */
  </script>

</body>
</html>